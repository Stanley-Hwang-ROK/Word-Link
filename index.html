<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Word-Link Puzzle ‚Äî Pastel 3D Edition</title>
  <meta name="theme-color" content="#f5f7fa">

  <style>
    :root {
      --bg:#f5f7fa;
      --panel:#ffffff;
      --text:#111;
    }

    body {
      margin:0;
      font-family: system-ui;
      background:var(--bg);
      color:var(--text);
      min-height:100vh;
      display:flex;
    }

    .wrap {
      margin:auto;
      width:min(95vw, 900px);
    }

    header {
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:12px 0;
    }

    /* BOARD GRID */
    .board {
      display:grid;
      gap:6px;
      padding:10px;
      grid-template-columns:repeat(8,48px);
      justify-content:center;
    }

    /* üé® 3D ÌååÏä§ÌÖî Îâ¥Î™®ÌîºÏ¶ò ÌÉÄÏùº */
    .tile {
      width:48px;
      height:48px;
      display:grid;
      place-items:center;

      border-radius:14px;

      /* Î∞∞Í≤ΩÏùÄ var(--tileColor)Î°ú Î∞õÏïÑÏò¥ */
      background: var(--tileColor);
      background: linear-gradient(
        145deg,
        rgba(255,255,255,0.9),
        rgba(0,0,0,0.08)
      );

      font-size:22px;
      font-weight:900;
      color:#1a1a1a;

      user-select:none;
      border:1px solid rgba(255,255,255,0.6);

      box-shadow:
        inset -3px -3px 6px rgba(255,255,255,0.8),
        inset 3px 3px 6px rgba(0,0,0,0.12),
        3px 3px 6px rgba(0,0,0,0.12),
        -2px -2px 4px rgba(255,255,255,0.7);

      transition:transform .12s ease, box-shadow .12s ease;
    }

    /* ÏÑ†ÌÉù Ìö®Í≥º */
    .tile.sel {
      transform:scale(1.06);
      box-shadow:
        inset -2px -2px 4px rgba(255,255,255,0.9),
        inset 4px 4px 6px rgba(0,0,0,0.18),
        4px 4px 8px rgba(0,0,0,0.15);
    }

    /* Îß§Ïπ≠Îêú ÌÉÄÏùº (Í∞ïÏ°∞Îêú 3D) */
    .tile.match {
      transform:scale(1.14);
      background: linear-gradient(145deg, #FFF4C7, #FFD76A);
      box-shadow:
        inset -2px -2px 5px rgba(255,255,255,0.9),
        inset 4px 4px 7px rgba(0,0,0,0.2),
        4px 4px 9px rgba(0,0,0,0.18);
    }

    .hud {
      display:flex;
      gap:10px;
      margin:10px 0;
      flex-wrap:wrap;
    }

    .badge {
      background:#ffffff;
      padding:6px 12px;
      border-radius:999px;
      font-weight:700;
      border:1px solid #dcdcdc;
    }

    .msg {
      min-height:20px;
      opacity:.9;
      margin-top:6px;
    }

    .category-btn {
      padding:10px 16px;
      margin:6px;
      border-radius:6px;
      background:#2563eb;
      border:none;
      font-size:16px;
      color:white;
      cursor:pointer;
    }

    #moves {
      color:#d97706;
      font-weight:900;
      transition:transform .15s ease;
    }

    #moves.bump {
      transform:scale(1.25);
    }

    /* GAME OVER OVERLAY */
    #gameover-overlay {
      position:fixed;
      top:0; left:0;
      width:100vw;
      height:100vh;
      background:rgba(0,0,0,0.75);
      display:none;
      flex-direction:column;
      justify-content:center;
      align-items:center;
      z-index:9999;
      animation: fadeIn .8s ease forwards;
    }

    #gameover-text {
      font-size:60px;
      font-weight:900;
      color:#facc15;
      text-shadow:0 0 20px black;
      animation:pulse 1s infinite alternate;
    }

    @keyframes fadeIn {
      from { opacity:0; }
      to { opacity:1; }
    }

    @keyframes pulse {
      from { transform:scale(0.9); opacity:.7; }
      to   { transform:scale(1.1); opacity:1; }
    }

    #btnRestart {
      margin-top:30px;
      padding:12px 20px;
      font-size:20px;
      border-radius:8px;
      background:#2563eb;
      color:white;
      border:none;
      cursor:pointer;
    }
  </style>
</head>

<body>
  <div class="wrap">

    <header>
      <h1 style="margin:0;">Word-Link (Pastel 3D Edition)</h1>
      <div>
        <button id="btnShuffle">Shuffle</button>
        <button id="btnNew">New Game</button>
      </div>
    </header>

    <div id="category-menu" style="text-align:center; margin:20px 0;">
      <h2>Select a Category</h2>
      <button class="category-btn" data-cat="animal">Animals</button>
      <button class="category-btn" data-cat="plant">Plants</button>
      <button class="category-btn" data-cat="jobs">Jobs & Places</button>
    </div>

    <div class="hud">
      <div class="badge">Score: <span id="score">0</span></div>
      <div class="badge">Moves: <span id="moves">10</span></div>
      <div class="badge">Dict: <span id="dictCount">0</span></div>
    </div>

    <div id="board" class="board"></div>
    <div id="msg" class="msg">Ïπ¥ÌÖåÍ≥†Î¶¨Î•º Î®ºÏ†Ä ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.</div>
  </div>

  <div id="gameover-overlay">
    <div id="gameover-text">GAME OVER</div>
    <button id="btnRestart">RESTART</button>
  </div>


<script>
/* ======================
   TTS (Ïú†ÏïÑÏö©)
====================== */
function speakWord(word){
  const u=new SpeechSynthesisUtterance(word);
  u.lang="en-US";
  u.rate=0.65;
  u.pitch=1.0;
  speechSynthesis.speak(u);
}

/* ======================
   SETTINGS
====================== */

const ROWS=10, COLS=8, MIN_WORD=3, MAX_WORD=6;

/* üé® ÎûúÎç§ ÌååÏä§ÌÖî 8Ï¢Ö */
const COLORS=[
  "#CDE9FF", // bright pastel blue (WÏïÑÏù¥ÏΩò ÎäêÎÇå)
  "#FFE4E4", // pastel pink
  "#FFF4C7", // pastel yellow
  "#DFFFE3", // pastel mint
  "#EADFFF", // pastel lilac
  "#FFE8D6", // pastel peach
  "#E4F1FF", // soft sky blue
  "#FFFBE6"  // cream
];

const CATEGORY_WORDS={
  animal:["CAT","DOG","LION","TIGER","BEAR","FROG","BIRD","FISH","COW","PIG","FOX","DEER","BEE","DUCK"],
  plant:["TREE","LEAF","ROSE","GRASS","SEED","FLOWER","ROOT","MOSS","BAMBOO","OAK","PINE","LILY"],
  jobs:["DOCTOR","NURSE","TEACHER","PILOT","CHEF","FARMER","POLICE","DRIVER","ARTIST","BAKER","CLERK","GUIDE"]
};

let LETTER_BAG="";
function buildLetterBag(list){ return list.join(""); }

let DICTIONARY=new Set();
let grid=Array.from({length:ROWS},()=>Array(COLS).fill(""));
let colorGrid=Array.from({length:ROWS},()=>Array(COLS).fill(""));

let score=0;
let moves=10;
let firstSel=null;

const elBoard=document.getElementById("board");
const elScore=document.getElementById("score");
const elMoves=document.getElementById("moves");
const elMsg=document.getElementById("msg");
const elDict=document.getElementById("dictCount");

/* UI */
function updateScore(){ elScore.textContent=score; }
function updateMoves(){
  elMoves.textContent=moves;
  elMoves.classList.add("bump");
  setTimeout(()=>elMoves.classList.remove("bump"),150);
}
function setMsg(t){ elMsg.textContent=t; }

/* BOARD */
function randLetter(){
  if(LETTER_BAG.length)
    return LETTER_BAG[Math.floor(Math.random()*LETTER_BAG.length)];

  const bag="EEEEEEAAA AAI IIOOOUU"+
            "NNNRRRTTTLLSS"+
            "DGGBCMPFHVWYKJXQZ";
  const letters=bag.replace(/\s/g,"");
  return letters[Math.floor(Math.random()*letters.length)];
}

function setupBoard(){
  for(let r=0;r<ROWS;r++){
    for(let c=0;c<COLS;c++){
      grid[r][c]=randLetter();
      colorGrid[r][c]=COLORS[Math.floor(Math.random()*COLORS.length)];
    }
  }
}

function renderAll(){
  elBoard.innerHTML="";
  for(let r=0;r<ROWS;r++){
    for(let c=0;c<COLS;c++){
      const d=document.createElement("div");
      d.className="tile";
      d.dataset.r=r;
      d.dataset.c=c;
      d.textContent=grid[r][c];

      /* üî• Îâ¥Î™®ÌîºÏ¶ò ÏÉâÏÉÅ Ï£ºÏûÖ */
      d.style.setProperty("--tileColor", colorGrid[r][c]);

      elBoard.appendChild(d);
    }
  }
}

/* EVENTS */
bindEvents();
function bindEvents(){

  document.getElementById("btnShuffle").onclick=shuffleBoard;

  document.getElementById("btnNew").onclick=()=>{
    score=0; updateScore();
    moves=10; updateMoves();
    firstSel=null;

    grid=Array.from({length:ROWS},()=>Array(COLS).fill(""));
    colorGrid=Array.from({length:ROWS},()=>Array(COLS).fill(""));
    renderAll();

    document.getElementById("category-menu").style.display="block";
    document.getElementById("gameover-overlay").style.display="none";
    setMsg("Ïπ¥ÌÖåÍ≥†Î¶¨Î•º Î®ºÏ†Ä ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.");
  };

  document.getElementById("btnRestart").onclick=()=>{
    document.getElementById("gameover-overlay").style.display="none";
    document.getElementById("category-menu").style.display="block";

    score=0; updateScore();
    moves=10; updateMoves();
    firstSel=null;

    grid=Array.from({length:ROWS},()=>Array(COLS).fill(""));
    colorGrid=Array.from({length:ROWS},()=>Array(COLS).fill(""));
    renderAll();

    setMsg("Ïπ¥ÌÖåÍ≥†Î¶¨Î•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.");
  };

  document.querySelectorAll(".category-btn").forEach(btn=>{
    btn.addEventListener("click",()=>{
      const cat=btn.dataset.cat;

      DICTIONARY=new Set(CATEGORY_WORDS[cat]);
      LETTER_BAG=buildLetterBag(CATEGORY_WORDS[cat]);
      elDict.textContent=DICTIONARY.size;

      document.getElementById("category-menu").style.display="none";

      score=0; updateScore();
      moves=10; updateMoves();

      setupBoard();
      renderAll();

      setMsg(`${cat} category loaded (${DICTIONARY.size} words).`);
    });
  });

  elBoard.addEventListener("click",onClickTile);
}

/* TILE INTERACTIONS */
async function onClickTile(e){
  if(moves<=0){ gameOver(); return; }

  const t=e.target.closest(".tile");
  if(!t) return;

  const r=+t.dataset.r, c=+t.dataset.c;

  if(!firstSel){
    firstSel={r,c};
    highlight(r,c,true);
    return;
  }

  if(firstSel.r===r && firstSel.c===c){
    highlight(r,c,false);
    firstSel=null;
    return;
  }

  if(!isNeighbor(firstSel.r,firstSel.c,r,c)){
    highlight(firstSel.r,firstSel.c,false);
    firstSel={r,c};
    highlight(r,c,true);
    return;
  }

  swap([firstSel.r,firstSel.c],[r,c]);
  highlight(firstSel.r,firstSel.c,false);
  highlight(r,c,false);
  firstSel=null;

  moves--; updateMoves();

  if(moves<=0){
    renderAll();
    gameOver();
    return;
  }

  renderAll();
  await resolveMatchesCascade();
}

function highlight(r,c,on){
  const el=document.querySelector(`[data-r="${r}"][data-c="${c}"]`);
  if(el) el.classList.toggle("sel",on);
}

function isNeighbor(r1,c1,r2,c2){
  return Math.abs(r1-r2)+Math.abs(c1-c2)==1;
}

function swap([r1,c1],[r2,c2]){
  [grid[r1][c1],grid[r2][c2]]=[grid[r2][c2],grid[r1][c1]];
  [colorGrid[r1][c1],colorGrid[r2][c2]]=[colorGrid[r2][c2],colorGrid[r1][c1]];
}

/* GAME OVER */
function gameOver(){
  setMsg("Game Over ‚Äî No moves left!");
  document.getElementById("gameover-overlay").style.display="flex";
}

/* MATCHING LOGIC */
async function resolveMatchesCascade(){
  let total=0;
  let lastWord="";

  while(true){
    const marks=findMatches();
    if(marks.size===0) break;

    const res=await clearMarked(marks);
    total+=res.count;
    if(res.exampleWord) lastWord=res.exampleWord;

    applyGravity();
    refill();
    renderAll();
  }

  if(total>0){
    score+=total*5;
    updateScore();

    if(lastWord) speakWord(lastWord);

    moves+=10;
    updateMoves();

    setMsg(lastWord?
      `Cleared (${total}). ex: ${lastWord} ‚Äî +10 moves` :
      `Cleared ${total} ‚Äî +10 moves`
    );
  } else {
    setMsg("No match");
  }
}

function findMatches(){
  const marks=new Set();
  let example="";

  for(let r=0;r<ROWS;r++){
    let c=0;
    while(c<COLS){
      let c2=c;
      while(c2+1<COLS && grid[r][c2+1]) c2++;
      if(c2-c+1>=MIN_WORD){
        const letters=grid[r].slice(c,c2+1).join("");
        markStrip(r,c,0,1,letters,marks,w=>example||=w);
      }
      c=c2+1;
    }
  }

  for(let c=0;c<COLS;c++){
    let r=0;
    while(r<ROWS){
      let r2=r;
      while(r2+1<ROWS && grid[r2+1][c]) r2++;
      if(r2-r+1>=MIN_WORD){
        let str="";
        for(let i=r;i<=r2;i++) str+=grid[i][c];
        markStrip(r,c,1,0,str,marks,w=>example||=w);
      }
      r=r2+1;
    }
  }

  marks.exampleWord=example;
  return marks;
}

function markStrip(r0,c0,dr,dc,str,marks,onExample){
  const n=str.length;
  for(let len=MIN_WORD; len<=Math.min(n,MAX_WORD); len++){
    for(let s=0; s+len<=n; s++){
      const word=str.slice(s,s+len).toUpperCase();
      if(DICTIONARY.has(word)){
        for(let k=0;k<len;k++){
          const rr=r0+(s+k)*dr;
          const cc=c0+(s+k)*dc;
          marks.add(`${rr},${cc}`);
        }
        if(onExample) onExample(word);
      }
    }
  }
}

async function clearMarked(marks){
  const exampleWord=marks.exampleWord||"";

  for(const pos of marks){
    const[r,c]=pos.split(",").map(Number);
    const el=document.querySelector(`[data-r="${r}"][data-c="${c}"]`);
    if(el) el.classList.add("match");
  }

  await new Promise(res=>setTimeout(res,500));

  let count=0;
  for(const pos of marks){
    const[r,c]=pos.split(",").map(Number);
    if(grid[r][c]){
      grid[r][c]="";
      count++;
    }
  }

  renderAll();
  return {count, exampleWord};
}

function applyGravity(){
  for(let c=0;c<COLS;c++){
    let w=ROWS-1;
    for(let r=ROWS-1;r>=0;r--){
      if(grid[r][c]){
        grid[w][c]=grid[r][c];
        if(w!==r) grid[r][c]="";
        w--;
      }
    }
  }
}

function refill(){
  for(let r=0;r<ROWS;r++){
    for(let c=0;c<COLS;c++){
      if(!grid[r][c]){
        grid[r][c]=randLetter();
        colorGrid[r][c]=COLORS[Math.floor(Math.random()*COLORS.length)];
      }
    }
  }
}

function shuffleBoard(){
  const arr=[];
  for(let r=0;r<ROWS;r++)
    for(let c=0;c<COLS;c++)
      arr.push(grid[r][c]);

  for(let i=arr.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]]=[arr[j],arr[i]];
  }

  let k=0;
  for(let r=0;r<ROWS;r++)
    for(let c=0;c<COLS;c++)
      grid[r][c]=arr[k++];

  renderAll();
  setMsg("Shuffled");
}

</script>

</body>
</html>
