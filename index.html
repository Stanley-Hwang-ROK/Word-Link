<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Word-Link Puzzle</title>
  <style>
    :root { --bg:#0f172a; --panel:#111827; --tile:#1f2937; --tileSel:#2563eb; --good:#16a34a; --bad:#dc2626; --text:#e5e7eb; --muted:#9ca3af; }
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; background:var(--bg); color:var(--text); display:flex; min-height:100vh; }
    .wrap { margin:auto; width:min(95vw, 900px); }
    header { display:flex; align-items:center; gap:12px; justify-content:space-between; margin-bottom:10px; }
    h1 { font-size:20px; font-weight:700; margin:0; letter-spacing:.3px; }
    .board { display:grid; gap:6px; background:linear-gradient(180deg, #0b1022, #0b1228); padding:10px; border-radius:16px; box-shadow: 0 10px 30px rgba(0,0,0,.35); }
    .hud { display:flex; gap:10px; flex-wrap:wrap; margin:10px 0 14px; }
    .badge { background:var(--panel); padding:8px 12px; border-radius:999px; font-weight:600; }
    button { background:#334155; color:var(--text); border:1px solid #475569; padding:10px 14px; border-radius:12px; cursor:pointer; font-weight:700; }
    button:hover { filter:brightness(1.1); }
    button:disabled { opacity:.5; cursor:not-allowed; }
    .tile { width:48px; height:48px; display:grid; place-items:center; border-radius:10px; background:var(--tile); border:1px solid #374151; user-select:none; font-weight:800; font-size:20px; }
    .tile.empty { visibility:hidden; }
    .tile.sel { background:var(--tileSel); }
    .msg { min-height:20px; color:var(--muted); font-weight:600; }
  </style>

  <!-- PWA -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0f172a">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
</head>
<body>
  <div class="wrap">
    <header>
      <h1>워드 링크 퍼즐</h1>
      <div>
        <button id="btnHint">힌트</button>
        <button id="btnShuffle">뒤섞기</button>
        <button id="btnNew">새로운 게임</button>
      </div>
    </header>
    <div class="hud">
      <div class="badge">점수: <span id="score">0</span></div>
      <div class="badge">선택한: <span id="currentWord"></span></div>
    </div>
    <div id="board" class="board"></div>
    <div class="msg" id="msg">인접한 문자(위/아래/좌/우)를 연결하여 유효한 단어를 형성하면 제거됩니다.</div>
  </div>

  <script>
  (() => {
    const ROWS = 10, COLS = 8, MIN_WORD = 3;
    const DICTIONARY = new Set(['CAT','DOG','SUN','SEA','TREE','STAR','BOOK','APPLE','RUN','PLAY','CODE','PUZZLE']);
    let grid = Array.from({length:ROWS},()=>Array(COLS).fill(''));
    let sel = [], score = 0, mouseDown=false;
    const elBoard=document.getElementById('board');
    const elScore=document.getElementById('score');
    const elWord=document.getElementById('currentWord');
    const elMsg=document.getElementById('msg');

    function randLetter(){
      const letters="ABCDEFGHIJKLMNOPQRSTUVWXYZ";
      return letters[Math.floor(Math.random()*letters.length)];
    }
    function setupBoard(){
      elBoard.style.gridTemplateColumns=`repeat(${COLS},48px)`;
      elBoard.style.gridTemplateRows=`repeat(${ROWS},48px)`;
      for(let r=0;r<ROWS;r++)for(let c=0;c<COLS;c++)grid[r][c]=randLetter();
    }
    function renderAll(){
      elBoard.innerHTML='';
      for(let r=0;r<ROWS;r++){
        for(let c=0;c<COLS;c++){
          const d=document.createElement('div');
          d.className='tile'; d.textContent=grid[r][c];
          d.dataset.r=r; d.dataset.c=c;
          elBoard.appendChild(d);
        }
      }
    }
    function updateScore(){elScore.textContent=score;}
    function updateWord(){elWord.textContent=sel.map(p=>grid[p.r][p.c]).join('');}
    function setMsg(s){elMsg.textContent=s;}

    elBoard.addEventListener('mousedown',e=>{
      const t=e.target.closest('.tile'); if(!t)return;
      mouseDown=true; sel=[]; const r=+t.dataset.r,c=+t.dataset.c;
      sel.push({r,c}); t.classList.add('sel'); updateWord();
    });
    document.addEventListener('mouseup',()=>{
      if(!mouseDown)return; mouseDown=false;
      const word=sel.map(p=>grid[p.r][p.c]).join('');
      if(word.length>=MIN_WORD && DICTIONARY.has(word)){
        score+=word.length*5; updateScore(); setMsg(`Cleared: ${word}`);
        for(const p of sel)grid[p.r][p.c]='';
        renderAll();
      }else setMsg(word.length?`Not a word: ${word}`:'');
      sel=[]; updateWord();
    });
    elBoard.addEventListener('mousemove',e=>{
      if(!mouseDown)return; const t=e.target.closest('.tile'); if(!t)return;
      const r=+t.dataset.r,c=+t.dataset.c,last=sel[sel.length-1];
      if(Math.abs(last.r-r)+Math.abs(last.c-c)===1 && !sel.some(p=>p.r===r&&p.c===c)){
        sel.push({r,c}); t.classList.add('sel'); updateWord();
      }
    });

    document.getElementById('btnNew').onclick=()=>{score=0;updateScore();setupBoard();renderAll();};
    document.getElementById('btnShuffle').onclick=()=>{grid.flat().sort(()=>Math.random()-0.5);renderAll();};
    document.getElementById('btnHint').onclick=()=>setMsg('Hint not implemented in demo');

    setupBoard(); renderAll(); updateScore();
  })();
  </script>

  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js').catch(console.error);
    }
  </script>
</body>
</html>
